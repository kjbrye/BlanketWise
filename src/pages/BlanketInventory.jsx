import { useState } from 'react';
import { Scale, Droplet, Wind, Thermometer, Check, Package, CloudRain, Leaf, Snowflake } from 'lucide-react';
import { QuiltedBlanketIcon, LinerIcon } from '../components/icons';
import { DeleteConfirmModal } from '../components/ui';

// Custom blanket icon (not available in lucide-react)
function BlanketIcon({ className = "w-5 h-5" }) {
  return (
    <svg className={className} viewBox="0 0 375 375" fill="currentColor" preserveAspectRatio="xMidYMid meet">
      <path fillRule="evenodd" d="M 76.132812 109.953125 C 75.617188 110.425781 74.273438 112.609375 73.148438 114.804688 C 72.023438 117 68.910156 122.078125 66.230469 126.085938 L 61.359375 133.375 L 63.398438 135.3125 C 65.925781 137.710938 67.800781 138.632812 70.574219 138.84375 C 74.511719 139.140625 75.992188 137.796875 80.96875 129.402344 C 83.683594 124.820312 88.503906 115.5625 88.503906 114.925781 C 88.503906 114.628906 77.855469 109.054688 77.335938 109.078125 C 77.191406 109.085938 76.648438 109.480469 76.132812 109.953125 M 91.445312 116.601562 C 90.164062 117.882812 92.957031 119.269531 104.945312 123.300781 C 118.324219 127.796875 132.773438 131.199219 146.058594 132.972656 C 158.054688 134.574219 162.492188 134.871094 174.164062 134.855469 C 186.898438 134.839844 196.058594 134.113281 211.804688 131.867188 C 216.871094 131.144531 222.734375 130.363281 224.835938 130.128906 C 226.941406 129.898438 230.554688 129.457031 232.867188 129.152344 C 263.277344 125.148438 299.933594 127.300781 322.070312 134.398438 C 323.382812 134.820312 324.460938 135.246094 324.460938 135.351562 C 324.460938 135.453125 325.152344 138.0625 326 141.148438 C 332.257812 163.941406 335.546875 192.121094 335.046875 218.65625 C 334.660156 239.320312 333.433594 245.125 328.390625 250.15625 C 323.410156 255.121094 316.777344 256.238281 298.644531 255.171875 C 277.996094 253.953125 262.246094 251.4375 223.5 243.171875 C 214.140625 241.175781 204.847656 239.222656 202.847656 238.832031 C 200.308594 238.332031 199.183594 237.945312 199.105469 237.542969 C 198.953125 236.753906 200.457031 234.910156 201.25 234.90625 C 201.601562 234.902344 205.761719 235.757812 210.496094 236.800781 C 227.144531 240.480469 231.449219 241.394531 243.828125 243.878906 C 270.074219 249.148438 287.234375 251.429688 304.765625 251.976562 C 314.503906 252.277344 318.59375 251.855469 322.027344 250.191406 C 330.035156 246.308594 331.714844 239.71875 331.71875 212.15625 C 331.722656 196.746094 331.1875 188.015625 329.410156 174.296875 C 328.789062 169.535156 326.863281 157.875 325.996094 153.644531 C 325.125 149.40625 322.277344 138.699219 321.765625 137.742188 C 321.359375 136.980469 317.644531 135.878906 309.734375 134.167969 C 296.871094 131.390625 287.515625 130.476562 269.292969 130.230469 C 250.585938 129.972656 243.605469 130.464844 219.292969 133.753906 C 193.941406 137.183594 187.21875 137.773438 173.65625 137.773438 C 148.375 137.769531 123.707031 133.3125 98.828125 124.261719 C 94.515625 122.691406 90.71875 121.296875 90.386719 121.164062 C 89.925781 120.976562 89.261719 121.878906 87.542969 125.042969 C 83.683594 132.132812 80.613281 137.132812 78.976562 138.984375 C 77.167969 141.035156 74.054688 142.738281 72.078125 142.761719 C 70.890625 142.773438 70.25 143.230469 67.011719 146.34375 C 59.910156 153.175781 52.820312 158.761719 41.167969 166.710938 C 22.292969 179.585938 21.410156 180.484375 20.933594 187.234375 L 20.699219 190.546875 L 27.351562 190.636719 C 31.011719 190.683594 35.640625 190.730469 37.640625 190.742188 C 44.058594 190.773438 44.074219 190.777344 45.753906 192.453125 L 47.277344 193.976562 L 47.144531 197.332031 C 47.039062 199.9375 46.839844 200.914062 46.242188 201.71875 C 44.738281 203.757812 43.605469 203.933594 31.894531 203.933594 L 21.195312 203.933594 L 21.195312 212.128906 C 21.195312 219.617188 21.253906 220.335938 21.863281 220.476562 C 22.234375 220.5625 27.007812 220.558594 32.476562 220.46875 C 42.308594 220.3125 42.4375 220.320312 44.140625 221.203125 C 46.394531 222.375 47.199219 223.980469 47.199219 227.300781 C 47.199219 229.289062 47.015625 230.101562 46.332031 231.125 C 44.636719 233.660156 44.089844 233.761719 31.808594 233.761719 L 20.8125 233.761719 L 20.820312 238.449219 C 20.832031 248.125 23.023438 252.742188 28.503906 254.652344 C 32.644531 256.09375 54.585938 255.316406 67.660156 253.261719 C 68.921875 253.0625 72.015625 252.632812 74.539062 252.300781 C 81.320312 251.414062 96.121094 248.84375 104.183594 247.152344 C 108.074219 246.339844 112.71875 245.386719 114.507812 245.039062 C 119.128906 244.144531 132.109375 241.308594 146.820312 237.984375 C 155.902344 235.929688 164.199219 234.144531 164.667969 234.144531 C 165.15625 234.144531 166.910156 236.964844 166.609375 237.265625 C 166.453125 237.421875 163.574219 238.085938 160.207031 238.742188 C 156.839844 239.402344 148.324219 241.230469 141.277344 242.804688 C 90.59375 254.136719 64.683594 258.292969 41.082031 258.867188 C 30.902344 259.117188 28.90625 258.871094 25.046875 256.910156 C 19.722656 254.207031 17.371094 248.496094 17.371094 238.289062 L 17.371094 233.71875 L 13.738281 233.953125 L 13.828125 239.691406 C 13.957031 248.195312 15.308594 252.988281 18.582031 256.542969 C 20.726562 258.875 22.410156 259.917969 26.0625 261.171875 C 28.675781 262.066406 29.777344 262.210938 35.152344 262.355469 C 54.898438 262.882812 88.4375 257.96875 132.671875 248.0625 C 152.132812 243.703125 157.402344 242.546875 163.074219 241.398438 L 168.621094 240.273438 L 169.480469 241.246094 C 170.277344 242.144531 170.636719 243.324219 170.121094 243.324219 C 169.332031 243.324219 150.976562 247.152344 141.085938 249.378906 C 134.566406 250.847656 127.804688 252.351562 126.058594 252.71875 C 124.3125 253.085938 123.023438 253.507812 123.191406 253.660156 C 123.632812 254.0625 131.410156 256.550781 134.96875 257.429688 C 136.648438 257.84375 140.398438 258.632812 143.300781 259.183594 C 149.179688 260.292969 150.105469 260.238281 156.480469 258.390625 C 162.203125 256.730469 165.6875 254.890625 171.707031 250.339844 C 173.191406 249.214844 174.535156 248.296875 174.6875 248.296875 C 175.210938 248.296875 180.285156 253.683594 180.285156 254.238281 C 180.285156 255.546875 176.167969 257.847656 169.957031 260.007812 L 166.324219 261.273438 L 171.105469 261.285156 C 176.5625 261.296875 189.941406 260.648438 191.375 260.300781 C 192.203125 260.101562 191.921875 259.882812 189.222656 258.628906 C 187.511719 257.832031 185.113281 256.445312 183.890625 255.539062 C 180.753906 253.222656 176.015625 248.617188 173.304688 245.246094 C 169.203125 240.148438 160.398438 226.554688 160.398438 225.324219 C 160.398438 224.796875 167.820312 219.992188 168.625 220 C 168.832031 220 171.03125 223.398438 173.507812 227.550781 C 179.457031 237.527344 182.335938 241.496094 187.167969 246.386719 C 191.199219 250.464844 194.546875 252.964844 198.84375 255.105469 C 201.570312 256.460938 205.667969 257.855469 206.925781 257.855469 C 209.199219 257.855469 228.472656 251.757812 228.46875 251.039062 C 228.46875 250.785156 225.546875 250.109375 205.90625 245.808594 C 194.707031 243.355469 194.816406 243.382812 194.816406 242.9375 C 194.816406 242.753906 195.203125 242.171875 195.675781 241.648438 L 196.539062 240.699219 L 203.613281 242.160156 C 207.503906 242.964844 213.355469 244.238281 216.613281 244.988281 C 223.929688 246.679688 241.097656 250.367188 246.253906 251.351562 C 275.171875 256.886719 290.96875 258.746094 309.351562 258.777344 C 317.28125 258.792969 319.339844 258.679688 321.398438 258.128906 C 328.699219 256.167969 334.035156 251.425781 335.980469 245.167969 C 339.675781 233.304688 339.472656 199.703125 335.542969 171.808594 C 333.792969 159.40625 329.125 138.59375 327.292969 135.035156 C 326.679688 133.84375 324.757812 133.136719 316.621094 131.121094 C 306.886719 128.710938 299.574219 127.523438 286.597656 126.25 C 279.5625 125.558594 275.519531 125.40625 264.417969 125.398438 C 249.625 125.386719 240.527344 126.058594 221.011719 128.605469 C 189.492188 132.714844 171.953125 133.625 155.042969 132.03125 C 147.175781 131.289062 134.152344 129.125 125.980469 127.203125 C 117.871094 125.292969 101.671875 120.171875 92.304688 116.5625 C 91.980469 116.4375 91.59375 116.453125 91.445312 116.601562 M 56.1875 138.777344 C 49.960938 144.535156 42.046875 150.554688 28.84375 159.570312 C 21.398438 164.65625 15.285156 169.363281 13.226562 171.59375 C 9.664062 175.460938 8.195312 179.394531 7.859375 185.960938 L 7.621094 190.738281 L 6.089844 190.945312 C 3.554688 191.285156 3.605469 191.152344 3.605469 197.632812 C 3.605469 204.285156 3.617188 204.316406 6.636719 204.316406 L 8.191406 204.316406 L 8.191406 207.664062 C 8.191406 209.503906 8.078125 213.203125 7.941406 215.882812 L 7.691406 220.761719 L 6.292969 220.761719 C 3.667969 220.761719 3.570312 221.011719 3.6875 227.414062 C 3.804688 233.664062 3.75 233.53125 6.328125 233.941406 L 7.71875 234.164062 L 7.894531 241.132812 C 8.050781 247.457031 8.164062 248.386719 9.113281 251.164062 C 9.683594 252.847656 10.589844 254.96875 11.125 255.886719 C 13.078125 259.238281 16.863281 262.042969 20.261719 262.652344 L 21.769531 262.925781 L 19.382812 261.316406 C 16.539062 259.402344 15.058594 257.703125 13.515625 254.585938 C 11.550781 250.617188 11.191406 248.691406 10.976562 240.933594 L 10.777344 233.761719 L 9.128906 233.761719 C 7.746094 233.761719 7.351562 233.585938 6.6875 232.652344 C 6.007812 231.691406 5.898438 230.972656 5.898438 227.382812 C 5.898438 223.390625 6.054688 222.710938 7.316406 221.160156 C 7.394531 221.0625 8.269531 220.890625 9.261719 220.777344 L 11.0625 220.570312 L 11.351562 215.214844 C 11.511719 212.269531 11.597656 208.570312 11.542969 206.992188 L 11.441406 204.125 L 9.449219 204.007812 C 7.835938 203.917969 7.304688 203.703125 6.675781 202.90625 C 5.996094 202.039062 5.898438 201.363281 5.898438 197.4375 C 5.898438 193.210938 5.953125 192.898438 6.835938 191.941406 C 7.585938 191.132812 8.125 190.929688 9.515625 190.929688 L 11.257812 190.929688 L 11.015625 187.777344 C 10.570312 181.980469 12.578125 176.960938 17.167969 172.375 C 19.960938 169.585938 20.449219 169.21875 36.492188 157.929688 C 48.515625 149.472656 51.671875 147.023438 59.4375 140.121094 L 61.160156 138.59375 L 58.863281 136.304688 Z M 330.980469 136.625 C 330.972656 136.730469 331.234375 137.679688 331.554688 138.730469 C 333.746094 145.878906 336.46875 158.113281 337.804688 166.839844 C 339.460938 177.640625 340.890625 190.90625 340.898438 195.570312 L 340.902344 197.71875 L 344.457031 200.980469 C 347.542969 203.8125 348.109375 204.1875 348.757812 203.828125 C 349.480469 203.429688 363.410156 193.75 366.144531 191.75 C 366.636719 191.386719 367.136719 191.023438 367.632812 190.667969 C 368.132812 190.324219 359.15625 175.261719 352.101562 164.609375 C 345.457031 154.574219 331.042969 135.480469 330.980469 136.625 M 59.125 143.882812 C 52.714844 150.023438 47.054688 154.230469 24.289062 169.800781 C 19.121094 173.332031 16.582031 176.046875 15.074219 179.648438 C 13.910156 182.433594 13.792969 183.066406 13.765625 186.722656 L 13.738281 190.738281 L 15.554688 190.855469 C 16.554688 190.921875 17.378906 190.921875 17.390625 190.855469 C 17.402344 190.792969 17.5 189.449219 17.609375 187.871094 C 18.195312 179.453125 19.769531 177.640625 36.253906 166.417969 C 41.265625 163.007812 40.890625 163.269531 46.816406 159.035156 C 52.621094 154.890625 55.734375 152.445312 60.875 147.996094 C 64.433594 144.914062 67.046875 142.136719 66.660156 141.847656 C 66.082031 141.414062 63.550781 140.070312 63.335938 140.085938 C 63.191406 140.097656 61.296875 141.804688 59.125 143.882812 M 142.304688 189.4375 C 139.816406 190.929688 137.679688 192.417969 137.554688 192.746094 C 137.429688 193.078125 137.570312 193.746094 137.867188 194.238281 C 139.300781 196.605469 148.679688 210.09375 149.0625 210.34375 C 149.300781 210.5 149.929688 211.449219 150.457031 212.457031 C 150.980469 213.464844 152.242188 215.421875 153.261719 216.808594 C 154.875 219.007812 155.179688 219.257812 155.664062 218.773438 C 156.148438 218.289062 156.097656 217.957031 155.253906 216.144531 C 154.722656 215.003906 154.289062 213.808594 154.292969 213.492188 C 154.304688 211.984375 157.871094 209.289062 159.851562 209.289062 C 161.230469 209.289062 161.816406 209.738281 163.070312 211.761719 C 163.882812 213.078125 164.71875 213.476562 165.160156 212.757812 C 165.457031 212.277344 160.335938 204.324219 159.730469 204.320312 C 159.464844 204.316406 159.25 204.015625 159.25 203.648438 C 159.25 203.277344 156.84375 199.320312 153.910156 194.851562 C 149.535156 188.195312 148.410156 186.726562 147.695312 186.726562 C 147.214844 186.726562 144.789062 187.945312 142.304688 189.4375 M 217.492188 187.96875 C 217.0625 188.441406 215.257812 191.066406 213.484375 193.800781 C 211.710938 196.535156 209.453125 199.863281 208.464844 201.203125 C 207.480469 202.539062 206.671875 203.757812 206.671875 203.910156 C 206.671875 204.0625 208.648438 205.433594 211.066406 206.957031 C 213.480469 208.480469 215.574219 209.914062 215.714844 210.140625 C 216.023438 210.640625 216.058594 210.660156 210.753906 207.25 C 205.910156 204.132812 206.4375 203.988281 203.253906 209.265625 C 201.476562 212.207031 201.359375 212.550781 201.910156 213.089844 C 202.457031 213.628906 202.582031 213.59375 203.238281 212.730469 C 205.441406 209.820312 205.609375 209.667969 206.65625 209.667969 C 208.101562 209.667969 211.347656 211.898438 211.800781 213.195312 C 212.089844 214.015625 211.976562 214.644531 211.28125 216.132812 C 210.394531 218.023438 210.417969 219.230469 211.34375 219.230469 C 211.761719 219.230469 216.613281 212.101562 216.613281 211.488281 C 216.613281 211.375 217.042969 210.789062 217.566406 210.1875 C 218.085938 209.585938 220.761719 205.761719 223.511719 201.6875 C 227.207031 196.207031 228.480469 194.023438 228.394531 193.308594 C 228.300781 192.53125 227.4375 191.839844 223.925781 189.726562 C 221.53125 188.285156 219.28125 187.105469 218.925781 187.105469 C 218.570312 187.105469 217.925781 187.492188 217.492188 187.96875 M 13.640625 192.332031 C 13.292969 192.472656 13.164062 193.871094 13.164062 197.472656 L 13.164062 202.421875 L 25.34375 202.394531 C 32.039062 202.378906 37.890625 202.265625 38.34375 202.148438 C 39.136719 201.941406 39.167969 201.730469 39.167969 197.003906 L 39.167969 192.078125 L 26.644531 192.109375 C 19.757812 192.125 13.90625 192.226562 13.640625 192.332031 M 40.699219 197.050781 L 40.699219 202.019531 L 42.007812 202.019531 C 43.839844 202.019531 44.46875 201.707031 45.109375 200.464844 C 46.476562 197.820312 45.375 193.292969 43.160156 192.449219 C 40.730469 191.527344 40.699219 191.582031 40.699219 197.050781 M 7.59375 192.960938 C 7.488281 193.238281 7.449219 195.433594 7.511719 197.839844 L 7.617188 202.210938 L 11.632812 202.445312 L 11.632812 192.460938 L 9.710938 192.460938 C 8.476562 192.460938 7.71875 192.640625 7.59375 192.960938 M 362.488281 196.757812 C 359.136719 199.160156 354.886719 202.128906 353.046875 203.351562 C 351.207031 204.578125 349.699219 205.746094 349.699219 205.953125 C 349.699219 206.160156 350.085938 206.667969 350.558594 207.082031 C 351.882812 208.234375 354.058594 207.816406 357.003906 205.835938 C 364.683594 200.671875 368.539062 197.664062 369.054688 196.4375 C 369.71875 194.847656 369.726562 193.945312 369.085938 193.074219 C 368.628906 192.445312 368.097656 192.742188 362.488281 196.757812 M 14.183594 204.1875 C 14.042969 204.328125 13.929688 208.113281 13.929688 212.601562 L 13.929688 220.761719 L 17.636719 220.761719 L 17.910156 212.726562 C 18.058594 208.308594 18.074219 204.523438 17.945312 204.3125 C 17.683594 203.890625 14.585938 203.789062 14.183594 204.1875 M 154.851562 206.824219 C 151.449219 209.054688 149.195312 210.753906 150.835938 209.847656 C 151.722656 209.363281 158.246094 205.023438 158.660156 204.648438 C 159.527344 203.855469 158.425781 204.484375 154.851562 206.824219 M 157.238281 210.796875 C 154.632812 212.453125 154.351562 213.289062 155.589844 215.730469 C 156.136719 216.816406 156.773438 217.699219 157.003906 217.699219 C 157.695312 217.699219 163.457031 213.808594 163.445312 213.347656 C 163.4375 213.113281 162.957031 212.230469 162.378906 211.390625 C 160.988281 209.375 159.707031 209.226562 157.238281 210.796875 M 205.464844 210.53125 C 204.46875 211.34375 203.167969 213.46875 203.421875 213.875 C 203.675781 214.285156 207.441406 216.902344 208.839844 217.640625 C 209.59375 218.039062 209.757812 217.917969 210.65625 216.3125 C 211.957031 213.984375 211.90625 213.421875 210.261719 211.980469 C 208.160156 210.132812 206.550781 209.644531 205.464844 210.53125 M 160.625 216.363281 C 157.070312 218.753906 153.914062 220.960938 153.613281 221.261719 C 153.136719 221.742188 153.152344 221.980469 153.730469 223.101562 C 154.695312 224.972656 155.886719 226.496094 156.378906 226.496094 C 156.898438 226.496094 170.550781 217.527344 170.902344 216.957031 C 171.039062 216.734375 170.601562 215.519531 169.929688 214.257812 C 169.007812 212.535156 168.503906 211.96875 167.898438 211.988281 C 167.453125 212.003906 164.183594 213.972656 160.625 216.363281 M 196.738281 213.972656 C 196.105469 215.078125 195.585938 216.28125 195.585938 216.644531 C 195.582031 217.347656 208.460938 226.101562 209.921875 226.390625 C 210.511719 226.507812 210.976562 226.054688 211.964844 224.394531 C 212.664062 223.214844 213.144531 222.003906 213.03125 221.707031 C 212.773438 221.039062 199.167969 211.964844 198.425781 211.964844 C 198.132812 211.964844 197.375 212.867188 196.738281 213.972656 M 195.976562 222.769531 C 193.050781 227.558594 188.28125 234.597656 185.800781 237.789062 C 183.710938 240.476562 183.46875 240.953125 183.859375 241.644531 C 184.722656 243.1875 188.898438 247.53125 189.519531 247.53125 C 189.867188 247.53125 191 246.539062 192.039062 245.332031 C 196.558594 240.0625 206.289062 226.53125 206.289062 225.507812 C 206.289062 225.039062 198.730469 219.996094 198.027344 219.996094 C 197.832031 219.996094 196.90625 221.242188 195.976562 222.769531 M 8.957031 222.28125 L 7.617188 222.480469 L 7.511719 227.066406 C 7.386719 232.332031 7.484375 232.515625 10.246094 232.296875 L 12.015625 232.15625 L 12.015625 227.269531 C 12.015625 222.496094 11.996094 222.375 11.15625 222.230469 C 10.683594 222.148438 9.695312 222.171875 8.957031 222.28125 M 15.363281 222.214844 L 13.546875 222.332031 L 13.546875 232.234375 L 38.773438 232.234375 L 38.996094 231.339844 C 39.121094 230.847656 39.164062 228.570312 39.097656 226.273438 L 38.976562 222.097656 L 28.078125 222.097656 C 22.085938 222.097656 16.363281 222.152344 15.363281 222.214844 M 40.546875 222.511719 C 40.246094 223.300781 40.246094 230.839844 40.546875 231.628906 C 41.027344 232.878906 44.261719 231.9375 45.109375 230.296875 C 45.417969 229.699219 45.667969 228.300781 45.667969 227.183594 C 45.667969 224.5 44.675781 222.855469 42.726562 222.316406 C 40.851562 221.796875 40.824219 221.796875 40.546875 222.511719 M 178.277344 232.890625 C 177.429688 233.097656 177.4375 233.207031 178.402344 234.769531 L 179.199219 236.058594 L 186.621094 236.058594 L 187.320312 234.875 C 187.703125 234.222656 187.871094 233.550781 187.6875 233.375 C 187.332031 233.027344 179.375 232.617188 178.277344 232.890625" />
    </svg>
  );
}

// Icon mapping
const iconMap = {
  blanket: BlanketIcon,
  scale: Scale,
  droplet: Droplet,
  wind: Wind,
  thermometer: Thermometer,
  check: Check,
  box: Package,
  rain: CloudRain,
  leaf: Leaf,
  snowflake: Snowflake,
};

function Icon({ name, className = "w-5 h-5" }) {
  const IconComponent = iconMap[name];
  if (!IconComponent) return null;
  return <IconComponent className={className} />;
}

// Weight categories for blankets
const weightCategories = [
  { label: 'Sheet (0g)', min: 0, max: 0, color: '#A0522D' },
  { label: 'Lightweight (50-150g)', min: 50, max: 150, color: '#D4A84B' },
  { label: 'Medium (200-300g)', min: 200, max: 300, color: '#E89B3C' },
  { label: 'Heavyweight (350g+)', min: 350, max: 500, color: '#5C4033' },
];

function getWeightCategory(grams) {
  if (grams === 0) return weightCategories[0];
  if (grams <= 150) return weightCategories[1];
  if (grams <= 300) return weightCategories[2];
  return weightCategories[3];
}

// Blanket Card Component
function BlanketCard({ blanket, pairedLiner, isInUse, onUpdate, onDelete, onSetInUse }) {
  const [isEditing, setIsEditing] = useState(false);
  const [editName, setEditName] = useState(blanket.name);
  const [editGrams, setEditGrams] = useState(blanket.grams);
  const [editWaterproof, setEditWaterproof] = useState(blanket.waterproof);
  const [editHasNeckRug, setEditHasNeckRug] = useState(blanket.hasNeckRug || false);
  const [editColor, setEditColor] = useState(blanket.color);

  const category = getWeightCategory(blanket.grams);

  const handleSave = () => {
    onUpdate({
      name: editName,
      grams: parseInt(editGrams),
      waterproof: editWaterproof,
      hasNeckRug: editHasNeckRug,
      color: editColor,
    });
    setIsEditing(false);
  };

  const handleCancel = () => {
    setEditName(blanket.name);
    setEditGrams(blanket.grams);
    setEditWaterproof(blanket.waterproof);
    setEditHasNeckRug(blanket.hasNeckRug || false);
    setEditColor(blanket.color);
    setIsEditing(false);
  };

  const colorOptions = [
    { value: '#B8D4E3', label: 'Light Blue' },
    { value: '#D4A84B', label: 'Gold' },
    { value: '#9CAF88', label: 'Sage Green' },
    { value: '#A0522D', label: 'Brown' },
    { value: '#8B4513', label: 'Saddle Brown' },
    { value: '#5C4033', label: 'Dark Brown' },
    { value: '#2C3E50', label: 'Navy' },
    { value: '#8E44AD', label: 'Purple' },
    { value: '#C0392B', label: 'Red' },
    { value: '#27AE60', label: 'Green' },
    { value: '#E74C3C', label: 'Coral' },
    { value: '#3498DB', label: 'Blue' },
  ];

  return (
    <div className={`bg-white rounded-2xl p-4 sm:p-6 shadow-lg border-2 transition-all ${
      isInUse ? 'border-[#E89B3C]' : 'border-[rgba(139,69,19,0.15)]'
    }`}>
      {/* Header */}
      <div className="flex flex-col sm:flex-row sm:items-start justify-between gap-3 mb-4">
        <div className="flex items-center gap-3 sm:gap-4">
          <div
            className="w-12 h-12 sm:w-16 sm:h-16 rounded-xl flex items-center justify-center shadow-md flex-shrink-0"
            style={{ backgroundColor: blanket.color }}
          >
            {blanket.waterproof ? (
              <svg className="w-8 h-8 sm:w-10 sm:h-10" viewBox="0 0 375 375" fill="none" preserveAspectRatio="xMidYMid meet">
                <path fill="white" fillOpacity="0.9" fillRule="evenodd" d="M 76.132812 109.953125 C 75.617188 110.425781 74.273438 112.609375 73.148438 114.804688 C 72.023438 117 68.910156 122.078125 66.230469 126.085938 L 61.359375 133.375 L 63.398438 135.3125 C 65.925781 137.710938 67.800781 138.632812 70.574219 138.84375 C 74.511719 139.140625 75.992188 137.796875 80.96875 129.402344 C 83.683594 124.820312 88.503906 115.5625 88.503906 114.925781 C 88.503906 114.628906 77.855469 109.054688 77.335938 109.078125 C 77.191406 109.085938 76.648438 109.480469 76.132812 109.953125 M 91.445312 116.601562 C 90.164062 117.882812 92.957031 119.269531 104.945312 123.300781 C 118.324219 127.796875 132.773438 131.199219 146.058594 132.972656 C 158.054688 134.574219 162.492188 134.871094 174.164062 134.855469 C 186.898438 134.839844 196.058594 134.113281 211.804688 131.867188 C 216.871094 131.144531 222.734375 130.363281 224.835938 130.128906 C 226.941406 129.898438 230.554688 129.457031 232.867188 129.152344 C 263.277344 125.148438 299.933594 127.300781 322.070312 134.398438 C 323.382812 134.820312 324.460938 135.246094 324.460938 135.351562 C 324.460938 135.453125 325.152344 138.0625 326 141.148438 C 332.257812 163.941406 335.546875 192.121094 335.046875 218.65625 C 334.660156 239.320312 333.433594 245.125 328.390625 250.15625 C 323.410156 255.121094 316.777344 256.238281 298.644531 255.171875 C 277.996094 253.953125 262.246094 251.4375 223.5 243.171875 C 214.140625 241.175781 204.847656 239.222656 202.847656 238.832031 C 200.308594 238.332031 199.183594 237.945312 199.105469 237.542969 C 198.953125 236.753906 200.457031 234.910156 201.25 234.90625 C 201.601562 234.902344 205.761719 235.757812 210.496094 236.800781 C 227.144531 240.480469 231.449219 241.394531 243.828125 243.878906 C 270.074219 249.148438 287.234375 251.429688 304.765625 251.976562 C 314.503906 252.277344 318.59375 251.855469 322.027344 250.191406 C 330.035156 246.308594 331.714844 239.71875 331.71875 212.15625 C 331.722656 196.746094 331.1875 188.015625 329.410156 174.296875 C 328.789062 169.535156 326.863281 157.875 325.996094 153.644531 C 325.125 149.40625 322.277344 138.699219 321.765625 137.742188 C 321.359375 136.980469 317.644531 135.878906 309.734375 134.167969 C 296.871094 131.390625 287.515625 130.476562 269.292969 130.230469 C 250.585938 129.972656 243.605469 130.464844 219.292969 133.753906 C 193.941406 137.183594 187.21875 137.773438 173.65625 137.773438 C 148.375 137.769531 123.707031 133.3125 98.828125 124.261719 C 94.515625 122.691406 90.71875 121.296875 90.386719 121.164062 C 89.925781 120.976562 89.261719 121.878906 87.542969 125.042969 C 83.683594 132.132812 80.613281 137.132812 78.976562 138.984375 C 77.167969 141.035156 74.054688 142.738281 72.078125 142.761719 C 70.890625 142.773438 70.25 143.230469 67.011719 146.34375 C 59.910156 153.175781 52.820312 158.761719 41.167969 166.710938 C 22.292969 179.585938 21.410156 180.484375 20.933594 187.234375 L 20.699219 190.546875 L 27.351562 190.636719 C 31.011719 190.683594 35.640625 190.730469 37.640625 190.742188 C 44.058594 190.773438 44.074219 190.777344 45.753906 192.453125 L 47.277344 193.976562 L 47.144531 197.332031 C 47.039062 199.9375 46.839844 200.914062 46.242188 201.71875 C 44.738281 203.757812 43.605469 203.933594 31.894531 203.933594 L 21.195312 203.933594 L 21.195312 212.128906 C 21.195312 219.617188 21.253906 220.335938 21.863281 220.476562 C 22.234375 220.5625 27.007812 220.558594 32.476562 220.46875 C 42.308594 220.3125 42.4375 220.320312 44.140625 221.203125 C 46.394531 222.375 47.199219 223.980469 47.199219 227.300781 C 47.199219 229.289062 47.015625 230.101562 46.332031 231.125 C 44.636719 233.660156 44.089844 233.761719 31.808594 233.761719 L 20.8125 233.761719 L 20.820312 238.449219 C 20.832031 248.125 23.023438 252.742188 28.503906 254.652344 C 32.644531 256.09375 54.585938 255.316406 67.660156 253.261719 C 68.921875 253.0625 72.015625 252.632812 74.539062 252.300781 C 81.320312 251.414062 96.121094 248.84375 104.183594 247.152344 C 108.074219 246.339844 112.71875 245.386719 114.507812 245.039062 C 119.128906 244.144531 132.109375 241.308594 146.820312 237.984375 C 155.902344 235.929688 164.199219 234.144531 164.667969 234.144531 C 165.15625 234.144531 166.910156 236.964844 166.609375 237.265625 C 166.453125 237.421875 163.574219 238.085938 160.207031 238.742188 C 156.839844 239.402344 148.324219 241.230469 141.277344 242.804688 C 90.59375 254.136719 64.683594 258.292969 41.082031 258.867188 C 30.902344 259.117188 28.90625 258.871094 25.046875 256.910156 C 19.722656 254.207031 17.371094 248.496094 17.371094 238.289062 L 17.371094 233.71875 L 13.738281 233.953125 L 13.828125 239.691406 C 13.957031 248.195312 15.308594 252.988281 18.582031 256.542969 C 20.726562 258.875 22.410156 259.917969 26.0625 261.171875 C 28.675781 262.066406 29.777344 262.210938 35.152344 262.355469 C 54.898438 262.882812 88.4375 257.96875 132.671875 248.0625 C 152.132812 243.703125 157.402344 242.546875 163.074219 241.398438 L 168.621094 240.273438 L 169.480469 241.246094 C 170.277344 242.144531 170.636719 243.324219 170.121094 243.324219 C 169.332031 243.324219 150.976562 247.152344 141.085938 249.378906 C 134.566406 250.847656 127.804688 252.351562 126.058594 252.71875 C 124.3125 253.085938 123.023438 253.507812 123.191406 253.660156 C 123.632812 254.0625 131.410156 256.550781 134.96875 257.429688 C 136.648438 257.84375 140.398438 258.632812 143.300781 259.183594 C 149.179688 260.292969 150.105469 260.238281 156.480469 258.390625 C 162.203125 256.730469 165.6875 254.890625 171.707031 250.339844 C 173.191406 249.214844 174.535156 248.296875 174.6875 248.296875 C 175.210938 248.296875 180.285156 253.683594 180.285156 254.238281 C 180.285156 255.546875 176.167969 257.847656 169.957031 260.007812 L 166.324219 261.273438 L 171.105469 261.285156 C 176.5625 261.296875 189.941406 260.648438 191.375 260.300781 C 192.203125 260.101562 191.921875 259.882812 189.222656 258.628906 C 187.511719 257.832031 185.113281 256.445312 183.890625 255.539062 C 180.753906 253.222656 176.015625 248.617188 173.304688 245.246094 C 169.203125 240.148438 160.398438 226.554688 160.398438 225.324219 C 160.398438 224.796875 167.820312 219.992188 168.625 220 C 168.832031 220 171.03125 223.398438 173.507812 227.550781 C 179.457031 237.527344 182.335938 241.496094 187.167969 246.386719 C 191.199219 250.464844 194.546875 252.964844 198.84375 255.105469 C 201.570312 256.460938 205.667969 257.855469 206.925781 257.855469 C 209.199219 257.855469 228.472656 251.757812 228.46875 251.039062 C 228.46875 250.785156 225.546875 250.109375 205.90625 245.808594 C 194.707031 243.355469 194.816406 243.382812 194.816406 242.9375 C 194.816406 242.753906 195.203125 242.171875 195.675781 241.648438 L 196.539062 240.699219 L 203.613281 242.160156 C 207.503906 242.964844 213.355469 244.238281 216.613281 244.988281 C 223.929688 246.679688 241.097656 250.367188 246.253906 251.351562 C 275.171875 256.886719 290.96875 258.746094 309.351562 258.777344 C 317.28125 258.792969 319.339844 258.679688 321.398438 258.128906 C 328.699219 256.167969 334.035156 251.425781 335.980469 245.167969 C 339.675781 233.304688 339.472656 199.703125 335.542969 171.808594 C 333.792969 159.40625 329.125 138.59375 327.292969 135.035156 C 326.679688 133.84375 324.757812 133.136719 316.621094 131.121094 C 306.886719 128.710938 299.574219 127.523438 286.597656 126.25 C 279.5625 125.558594 275.519531 125.40625 264.417969 125.398438 C 249.625 125.386719 240.527344 126.058594 221.011719 128.605469 C 189.492188 132.714844 171.953125 133.625 155.042969 132.03125 C 147.175781 131.289062 134.152344 129.125 125.980469 127.203125 C 117.871094 125.292969 101.671875 120.171875 92.304688 116.5625 C 91.980469 116.4375 91.59375 116.453125 91.445312 116.601562 M 56.1875 138.777344 C 49.960938 144.535156 42.046875 150.554688 28.84375 159.570312 C 21.398438 164.65625 15.285156 169.363281 13.226562 171.59375 C 9.664062 175.460938 8.195312 179.394531 7.859375 185.960938 L 7.621094 190.738281 L 6.089844 190.945312 C 3.554688 191.285156 3.605469 191.152344 3.605469 197.632812 C 3.605469 204.285156 3.617188 204.316406 6.636719 204.316406 L 8.191406 204.316406 L 8.191406 207.664062 C 8.191406 209.503906 8.078125 213.203125 7.941406 215.882812 L 7.691406 220.761719 L 6.292969 220.761719 C 3.667969 220.761719 3.570312 221.011719 3.6875 227.414062 C 3.804688 233.664062 3.75 233.53125 6.328125 233.941406 L 7.71875 234.164062 L 7.894531 241.132812 C 8.050781 247.457031 8.164062 248.386719 9.113281 251.164062 C 9.683594 252.847656 10.589844 254.96875 11.125 255.886719 C 13.078125 259.238281 16.863281 262.042969 20.261719 262.652344 L 21.769531 262.925781 L 19.382812 261.316406 C 16.539062 259.402344 15.058594 257.703125 13.515625 254.585938 C 11.550781 250.617188 11.191406 248.691406 10.976562 240.933594 L 10.777344 233.761719 L 9.128906 233.761719 C 7.746094 233.761719 7.351562 233.585938 6.6875 232.652344 C 6.007812 231.691406 5.898438 230.972656 5.898438 227.382812 C 5.898438 223.390625 6.054688 222.710938 7.316406 221.160156 C 7.394531 221.0625 8.269531 220.890625 9.261719 220.777344 L 11.0625 220.570312 L 11.351562 215.214844 C 11.511719 212.269531 11.597656 208.570312 11.542969 206.992188 L 11.441406 204.125 L 9.449219 204.007812 C 7.835938 203.917969 7.304688 203.703125 6.675781 202.90625 C 5.996094 202.039062 5.898438 201.363281 5.898438 197.4375 C 5.898438 193.210938 5.953125 192.898438 6.835938 191.941406 C 7.585938 191.132812 8.125 190.929688 9.515625 190.929688 L 11.257812 190.929688 L 11.015625 187.777344 C 10.570312 181.980469 12.578125 176.960938 17.167969 172.375 C 19.960938 169.585938 20.449219 169.21875 36.492188 157.929688 C 48.515625 149.472656 51.671875 147.023438 59.4375 140.121094 L 61.160156 138.59375 L 58.863281 136.304688 Z M 330.980469 136.625 C 330.972656 136.730469 331.234375 137.679688 331.554688 138.730469 C 333.746094 145.878906 336.46875 158.113281 337.804688 166.839844 C 339.460938 177.640625 340.890625 190.90625 340.898438 195.570312 L 340.902344 197.71875 L 344.457031 200.980469 C 347.542969 203.8125 348.109375 204.1875 348.757812 203.828125 C 349.480469 203.429688 363.410156 193.75 366.144531 191.75 C 366.636719 191.386719 367.136719 191.023438 367.632812 190.667969 C 368.132812 190.324219 359.15625 175.261719 352.101562 164.609375 C 345.457031 154.574219 331.042969 135.480469 330.980469 136.625 M 59.125 143.882812 C 52.714844 150.023438 47.054688 154.230469 24.289062 169.800781 C 19.121094 173.332031 16.582031 176.046875 15.074219 179.648438 C 13.910156 182.433594 13.792969 183.066406 13.765625 186.722656 L 13.738281 190.738281 L 15.554688 190.855469 C 16.554688 190.921875 17.378906 190.921875 17.390625 190.855469 C 17.402344 190.792969 17.5 189.449219 17.609375 187.871094 C 18.195312 179.453125 19.769531 177.640625 36.253906 166.417969 C 41.265625 163.007812 40.890625 163.269531 46.816406 159.035156 C 52.621094 154.890625 55.734375 152.445312 60.875 147.996094 C 64.433594 144.914062 67.046875 142.136719 66.660156 141.847656 C 66.082031 141.414062 63.550781 140.070312 63.335938 140.085938 C 63.191406 140.097656 61.296875 141.804688 59.125 143.882812 M 142.304688 189.4375 C 139.816406 190.929688 137.679688 192.417969 137.554688 192.746094 C 137.429688 193.078125 137.570312 193.746094 137.867188 194.238281 C 139.300781 196.605469 148.679688 210.09375 149.0625 210.34375 C 149.300781 210.5 149.929688 211.449219 150.457031 212.457031 C 150.980469 213.464844 152.242188 215.421875 153.261719 216.808594 C 154.875 219.007812 155.179688 219.257812 155.664062 218.773438 C 156.148438 218.289062 156.097656 217.957031 155.253906 216.144531 C 154.722656 215.003906 154.289062 213.808594 154.292969 213.492188 C 154.304688 211.984375 157.871094 209.289062 159.851562 209.289062 C 161.230469 209.289062 161.816406 209.738281 163.070312 211.761719 C 163.882812 213.078125 164.71875 213.476562 165.160156 212.757812 C 165.457031 212.277344 160.335938 204.324219 159.730469 204.320312 C 159.464844 204.316406 159.25 204.015625 159.25 203.648438 C 159.25 203.277344 156.84375 199.320312 153.910156 194.851562 C 149.535156 188.195312 148.410156 186.726562 147.695312 186.726562 C 147.214844 186.726562 144.789062 187.945312 142.304688 189.4375 M 217.492188 187.96875 C 217.0625 188.441406 215.257812 191.066406 213.484375 193.800781 C 211.710938 196.535156 209.453125 199.863281 208.464844 201.203125 C 207.480469 202.539062 206.671875 203.757812 206.671875 203.910156 C 206.671875 204.0625 208.648438 205.433594 211.066406 206.957031 C 213.480469 208.480469 215.574219 209.914062 215.714844 210.140625 C 216.023438 210.640625 216.058594 210.660156 210.753906 207.25 C 205.910156 204.132812 206.4375 203.988281 203.253906 209.265625 C 201.476562 212.207031 201.359375 212.550781 201.910156 213.089844 C 202.457031 213.628906 202.582031 213.59375 203.238281 212.730469 C 205.441406 209.820312 205.609375 209.667969 206.65625 209.667969 C 208.101562 209.667969 211.347656 211.898438 211.800781 213.195312 C 212.089844 214.015625 211.976562 214.644531 211.28125 216.132812 C 210.394531 218.023438 210.417969 219.230469 211.34375 219.230469 C 211.761719 219.230469 216.613281 212.101562 216.613281 211.488281 C 216.613281 211.375 217.042969 210.789062 217.566406 210.1875 C 218.085938 209.585938 220.761719 205.761719 223.511719 201.6875 C 227.207031 196.207031 228.480469 194.023438 228.394531 193.308594 C 228.300781 192.53125 227.4375 191.839844 223.925781 189.726562 C 221.53125 188.285156 219.28125 187.105469 218.925781 187.105469 C 218.570312 187.105469 217.925781 187.492188 217.492188 187.96875 M 13.640625 192.332031 C 13.292969 192.472656 13.164062 193.871094 13.164062 197.472656 L 13.164062 202.421875 L 25.34375 202.394531 C 32.039062 202.378906 37.890625 202.265625 38.34375 202.148438 C 39.136719 201.941406 39.167969 201.730469 39.167969 197.003906 L 39.167969 192.078125 L 26.644531 192.109375 C 19.757812 192.125 13.90625 192.226562 13.640625 192.332031 M 40.699219 197.050781 L 40.699219 202.019531 L 42.007812 202.019531 C 43.839844 202.019531 44.46875 201.707031 45.109375 200.464844 C 46.476562 197.820312 45.375 193.292969 43.160156 192.449219 C 40.730469 191.527344 40.699219 191.582031 40.699219 197.050781 M 7.59375 192.960938 C 7.488281 193.238281 7.449219 195.433594 7.511719 197.839844 L 7.617188 202.210938 L 11.632812 202.445312 L 11.632812 192.460938 L 9.710938 192.460938 C 8.476562 192.460938 7.71875 192.640625 7.59375 192.960938 M 362.488281 196.757812 C 359.136719 199.160156 354.886719 202.128906 353.046875 203.351562 C 351.207031 204.578125 349.699219 205.746094 349.699219 205.953125 C 349.699219 206.160156 350.085938 206.667969 350.558594 207.082031 C 351.882812 208.234375 354.058594 207.816406 357.003906 205.835938 C 364.683594 200.671875 368.539062 197.664062 369.054688 196.4375 C 369.71875 194.847656 369.726562 193.945312 369.085938 193.074219 C 368.628906 192.445312 368.097656 192.742188 362.488281 196.757812 M 14.183594 204.1875 C 14.042969 204.328125 13.929688 208.113281 13.929688 212.601562 L 13.929688 220.761719 L 17.636719 220.761719 L 17.910156 212.726562 C 18.058594 208.308594 18.074219 204.523438 17.945312 204.3125 C 17.683594 203.890625 14.585938 203.789062 14.183594 204.1875 M 154.851562 206.824219 C 151.449219 209.054688 149.195312 210.753906 150.835938 209.847656 C 151.722656 209.363281 158.246094 205.023438 158.660156 204.648438 C 159.527344 203.855469 158.425781 204.484375 154.851562 206.824219 M 157.238281 210.796875 C 154.632812 212.453125 154.351562 213.289062 155.589844 215.730469 C 156.136719 216.816406 156.773438 217.699219 157.003906 217.699219 C 157.695312 217.699219 163.457031 213.808594 163.445312 213.347656 C 163.4375 213.113281 162.957031 212.230469 162.378906 211.390625 C 160.988281 209.375 159.707031 209.226562 157.238281 210.796875 M 205.464844 210.53125 C 204.46875 211.34375 203.167969 213.46875 203.421875 213.875 C 203.675781 214.285156 207.441406 216.902344 208.839844 217.640625 C 209.59375 218.039062 209.757812 217.917969 210.65625 216.3125 C 211.957031 213.984375 211.90625 213.421875 210.261719 211.980469 C 208.160156 210.132812 206.550781 209.644531 205.464844 210.53125 M 160.625 216.363281 C 157.070312 218.753906 153.914062 220.960938 153.613281 221.261719 C 153.136719 221.742188 153.152344 221.980469 153.730469 223.101562 C 154.695312 224.972656 155.886719 226.496094 156.378906 226.496094 C 156.898438 226.496094 170.550781 217.527344 170.902344 216.957031 C 171.039062 216.734375 170.601562 215.519531 169.929688 214.257812 C 169.007812 212.535156 168.503906 211.96875 167.898438 211.988281 C 167.453125 212.003906 164.183594 213.972656 160.625 216.363281 M 196.738281 213.972656 C 196.105469 215.078125 195.585938 216.28125 195.585938 216.644531 C 195.582031 217.347656 208.460938 226.101562 209.921875 226.390625 C 210.511719 226.507812 210.976562 226.054688 211.964844 224.394531 C 212.664062 223.214844 213.144531 222.003906 213.03125 221.707031 C 212.773438 221.039062 199.167969 211.964844 198.425781 211.964844 C 198.132812 211.964844 197.375 212.867188 196.738281 213.972656 M 195.976562 222.769531 C 193.050781 227.558594 188.28125 234.597656 185.800781 237.789062 C 183.710938 240.476562 183.46875 240.953125 183.859375 241.644531 C 184.722656 243.1875 188.898438 247.53125 189.519531 247.53125 C 189.867188 247.53125 191 246.539062 192.039062 245.332031 C 196.558594 240.0625 206.289062 226.53125 206.289062 225.507812 C 206.289062 225.039062 198.730469 219.996094 198.027344 219.996094 C 197.832031 219.996094 196.90625 221.242188 195.976562 222.769531 M 8.957031 222.28125 L 7.617188 222.480469 L 7.511719 227.066406 C 7.386719 232.332031 7.484375 232.515625 10.246094 232.296875 L 12.015625 232.15625 L 12.015625 227.269531 C 12.015625 222.496094 11.996094 222.375 11.15625 222.230469 C 10.683594 222.148438 9.695312 222.171875 8.957031 222.28125 M 15.363281 222.214844 L 13.546875 222.332031 L 13.546875 232.234375 L 38.773438 232.234375 L 38.996094 231.339844 C 39.121094 230.847656 39.164062 228.570312 39.097656 226.273438 L 38.976562 222.097656 L 28.078125 222.097656 C 22.085938 222.097656 16.363281 222.152344 15.363281 222.214844 M 40.546875 222.511719 C 40.246094 223.300781 40.246094 230.839844 40.546875 231.628906 C 41.027344 232.878906 44.261719 231.9375 45.109375 230.296875 C 45.417969 229.699219 45.667969 228.300781 45.667969 227.183594 C 45.667969 224.5 44.675781 222.855469 42.726562 222.316406 C 40.851562 221.796875 40.824219 221.796875 40.546875 222.511719 M 178.277344 232.890625 C 177.429688 233.097656 177.4375 233.207031 178.402344 234.769531 L 179.199219 236.058594 L 186.621094 236.058594 L 187.320312 234.875 C 187.703125 234.222656 187.871094 233.550781 187.6875 233.375 C 187.332031 233.027344 179.375 232.617188 178.277344 232.890625" />
              </svg>
            ) : (
              <QuiltedBlanketIcon className="w-8 h-8 sm:w-10 sm:h-10 text-white/90" />
            )}
          </div>
          <div>
            {isEditing ? (
              <input
                type="text"
                value={editName}
                onChange={(e) => setEditName(e.target.value)}
                className="text-xl font-display font-bold text-[#5C4033] border-b-2 border-[#D4A84B] bg-transparent focus:outline-none"
              />
            ) : (
              <h3 className="font-display text-lg sm:text-xl font-bold text-[#5C4033]">{blanket.name}</h3>
            )}
            <div className="flex items-center gap-1 sm:gap-2 mt-1 flex-wrap">
              <span
                className="text-xs font-medium px-2 py-0.5 rounded-full text-white"
                style={{ backgroundColor: category.color }}
              >
                {category.label}
              </span>
              {pairedLiner && (
                <span className="text-xs font-medium px-2 py-0.5 rounded-full bg-[#9CAF88]/20 text-[#9CAF88]">
                  + {pairedLiner.name}
                </span>
              )}
              {isInUse && (
                <span className="text-xs font-medium px-2 py-0.5 rounded-full bg-[#E89B3C]/20 text-[#E89B3C]">
                  Currently In Use
                </span>
              )}
            </div>
          </div>
        </div>
        <div className="flex gap-2 flex-shrink-0">
          {isEditing ? (
            <>
              <button
                onClick={handleSave}
                className="px-4 py-2 min-h-[44px] bg-[#9CAF88] text-white rounded-lg hover:bg-[#7d9470] transition-colors text-sm"
              >
                Save
              </button>
              <button
                onClick={handleCancel}
                className="px-4 py-2 min-h-[44px] bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors text-sm"
              >
                Cancel
              </button>
            </>
          ) : (
            <>
              <button
                onClick={() => setIsEditing(true)}
                className="px-3 py-2 min-h-[44px] bg-[#FDF8F0] text-[#8B4513] rounded-lg hover:bg-[#D4A84B]/20 transition-colors text-sm"
              >
                Edit
              </button>
              <button
                onClick={onDelete}
                className="px-3 py-2 min-h-[44px] bg-red-50 text-red-600 rounded-lg hover:bg-red-100 transition-colors text-sm"
              >
                Delete
              </button>
            </>
          )}
        </div>
      </div>

      {/* Details */}
      {isEditing ? (
        <div className="grid grid-cols-1 sm:grid-cols-2 gap-4 mb-4">
          <div>
            <label className="block text-sm font-medium text-[#2C1810] mb-1">Fill Weight (grams)</label>
            <input
              type="number"
              value={editGrams}
              onChange={(e) => setEditGrams(e.target.value)}
              className="w-full px-3 py-2 rounded-lg border border-[rgba(139,69,19,0.3)] focus:border-[#D4A84B] focus:outline-none"
              min="0"
              max="500"
            />
          </div>
          <div>
            <label className="block text-sm font-medium text-[#2C1810] mb-1">Color</label>
            <div className="flex flex-wrap gap-2">
              {colorOptions.map(option => (
                <button
                  key={option.value}
                  onClick={() => setEditColor(option.value)}
                  className={`w-8 h-8 rounded-full border-2 transition-all ${
                    editColor === option.value ? 'border-[#5C4033] scale-110' : 'border-transparent'
                  }`}
                  style={{ backgroundColor: option.value }}
                  title={option.label}
                />
              ))}
            </div>
          </div>
          <div>
            <label className="flex items-center gap-3 cursor-pointer">
              <input
                type="checkbox"
                checked={editWaterproof}
                onChange={(e) => setEditWaterproof(e.target.checked)}
                className="w-5 h-5 rounded border-gray-300 text-[#9CAF88] focus:ring-[#9CAF88]"
              />
              <span className="text-sm font-medium text-[#2C1810]">Waterproof</span>
            </label>
          </div>
          <div>
            <label className="flex items-center gap-3 cursor-pointer">
              <input
                type="checkbox"
                checked={editHasNeckRug}
                onChange={(e) => setEditHasNeckRug(e.target.checked)}
                className="w-5 h-5 rounded border-gray-300 text-[#9CAF88] focus:ring-[#9CAF88]"
              />
              <span className="text-sm font-medium text-[#2C1810]">Has Neck Rug</span>
            </label>
          </div>
        </div>
      ) : (
        <div className="grid grid-cols-2 sm:grid-cols-4 gap-2 sm:gap-3 mb-4">
          <div className={`rounded-xl p-2 sm:p-3 text-center ${pairedLiner ? 'bg-[#9CAF88]/10' : 'bg-[#FDF8F0]'}`}>
            <div className="flex justify-center text-[#8B4513] mb-1">
              <Icon name="scale" className="w-5 h-5" />
            </div>
            <div className="text-xs text-[#6B5344]">{pairedLiner ? 'Combined' : 'Fill Weight'}</div>
            {pairedLiner ? (
              <div>
                <div className="font-semibold text-[#5C4033]">{blanket.grams + pairedLiner.grams}g</div>
                <div className="text-xs text-[#6B5344]">{blanket.grams}g + {pairedLiner.grams}g</div>
              </div>
            ) : (
              <div className="font-semibold text-[#5C4033]">{blanket.grams}g</div>
            )}
          </div>
          <div className="bg-[#FDF8F0] rounded-xl p-2 sm:p-3 text-center">
            <div className="flex justify-center text-[#8B4513] mb-1">
              <Icon name={blanket.waterproof ? 'droplet' : 'wind'} className="w-4 h-4 sm:w-5 sm:h-5" />
            </div>
            <div className="text-xs text-[#6B5344]">Type</div>
            <div className="font-semibold text-[#5C4033] text-sm sm:text-base">{blanket.waterproof ? 'Waterproof' : 'Breathable'}</div>
          </div>
          <div className="bg-[#FDF8F0] rounded-xl p-2 sm:p-3 text-center">
            <div className="flex justify-center text-[#8B4513] mb-1">
              <Icon name="check" className="w-4 h-4 sm:w-5 sm:h-5" />
            </div>
            <div className="text-xs text-[#6B5344]">Neck Rug</div>
            <div className="font-semibold text-[#5C4033] text-sm sm:text-base">{blanket.hasNeckRug ? 'Yes' : 'No'}</div>
          </div>
          <div className="bg-[#FDF8F0] rounded-xl p-2 sm:p-3 text-center">
            <div className="flex justify-center text-[#8B4513] mb-1">
              <Icon name="thermometer" className="w-4 h-4 sm:w-5 sm:h-5" />
            </div>
            <div className="text-xs text-[#6B5344]">Best For</div>
            <div className="font-semibold text-[#5C4033] text-sm sm:text-base">
              {blanket.grams === 0 ? 'Above 40째F' :
               blanket.grams <= 150 ? '30-40째F' :
               blanket.grams <= 300 ? '15-30째F' : 'Below 15째F'}
            </div>
          </div>
        </div>
      )}

      {/* Actions */}
      {!isEditing && (
        <button
          onClick={onSetInUse}
          className={`w-full py-3 rounded-xl font-semibold transition-colors ${
            isInUse
              ? 'bg-[#E89B3C]/20 text-[#E89B3C] border-2 border-[#E89B3C]'
              : 'bg-[#8B4513] text-white hover:bg-[#5C4033]'
          }`}
        >
          {isInUse ? 'Currently In Use' : 'Mark as In Use'}
        </button>
      )}
    </div>
  );
}

// Add Blanket Form
function AddBlanketForm({ onAdd, onCancel }) {
  const [name, setName] = useState('');
  const [grams, setGrams] = useState('200');
  const [waterproof, setWaterproof] = useState(true);
  const [hasNeckRug, setHasNeckRug] = useState(false);
  const [color, setColor] = useState('#B8D4E3');

  const colorOptions = [
    { value: '#B8D4E3', label: 'Light Blue' },
    { value: '#D4A84B', label: 'Gold' },
    { value: '#9CAF88', label: 'Sage Green' },
    { value: '#A0522D', label: 'Brown' },
    { value: '#8B4513', label: 'Saddle Brown' },
    { value: '#5C4033', label: 'Dark Brown' },
    { value: '#2C3E50', label: 'Navy' },
    { value: '#8E44AD', label: 'Purple' },
    { value: '#C0392B', label: 'Red' },
    { value: '#27AE60', label: 'Green' },
  ];

  const handleSubmit = (e) => {
    e.preventDefault();
    if (!name.trim()) return;

    onAdd({
      id: Date.now(),
      name: name.trim(),
      grams: parseInt(grams),
      waterproof,
      hasNeckRug,
      color,
      status: 'available',
    });
  };

  return (
    <div className="bg-white rounded-2xl p-6 shadow-lg border-2 border-dashed border-[#D4A84B]">
      <h2 className="font-display text-xl font-semibold text-[#5C4033] mb-4">Add New Blanket</h2>
      <form onSubmit={handleSubmit} className="space-y-4">
        <div>
          <label className="block text-sm font-medium text-[#2C1810] mb-1">Blanket Name *</label>
          <input
            type="text"
            value={name}
            onChange={(e) => setName(e.target.value)}
            className="w-full px-4 py-2 rounded-lg border border-[rgba(139,69,19,0.3)] focus:border-[#D4A84B] focus:outline-none"
            placeholder="e.g., Dover Heavyweight"
            required
          />
        </div>

        <div className="grid grid-cols-2 gap-4">
          <div>
            <label className="block text-sm font-medium text-[#2C1810] mb-1">Fill Weight (grams)</label>
            <select
              value={grams}
              onChange={(e) => setGrams(e.target.value)}
              className="w-full px-4 py-2 rounded-lg border border-[rgba(139,69,19,0.3)] focus:border-[#D4A84B] focus:outline-none"
            >
              <option value="0">Sheet (0g)</option>
              <option value="100">Lightweight (100g)</option>
              <option value="150">Lightweight (150g)</option>
              <option value="200">Medium (200g)</option>
              <option value="250">Medium (250g)</option>
              <option value="300">Medium (300g)</option>
              <option value="360">Heavyweight (360g)</option>
              <option value="400">Heavyweight (400g)</option>
            </select>
          </div>
          <div>
            <label className="block text-sm font-medium text-[#2C1810] mb-1">Type</label>
            <select
              value={waterproof ? 'waterproof' : 'breathable'}
              onChange={(e) => setWaterproof(e.target.value === 'waterproof')}
              className="w-full px-4 py-2 rounded-lg border border-[rgba(139,69,19,0.3)] focus:border-[#D4A84B] focus:outline-none"
            >
              <option value="waterproof">Waterproof Turnout</option>
              <option value="breathable">Breathable/Stable</option>
            </select>
          </div>
        </div>

        <div>
          <label className="block text-sm font-medium text-[#2C1810] mb-2">Color</label>
          <div className="flex flex-wrap gap-2">
            {colorOptions.map(option => (
              <button
                key={option.value}
                type="button"
                onClick={() => setColor(option.value)}
                className={`w-10 h-10 rounded-full border-2 transition-all ${
                  color === option.value ? 'border-[#5C4033] scale-110' : 'border-gray-200'
                }`}
                style={{ backgroundColor: option.value }}
                title={option.label}
              />
            ))}
          </div>
        </div>

        <div>
          <label className="flex items-center gap-3 cursor-pointer">
            <input
              type="checkbox"
              checked={hasNeckRug}
              onChange={(e) => setHasNeckRug(e.target.checked)}
              className="w-5 h-5 rounded border-gray-300 text-[#9CAF88] focus:ring-[#9CAF88]"
            />
            <span className="text-sm font-medium text-[#2C1810]">Has Neck Rug</span>
          </label>
        </div>

        <div className="flex gap-3 pt-2">
          <button
            type="submit"
            className="flex-1 py-3 bg-[#8B4513] text-white rounded-xl font-semibold hover:bg-[#5C4033] transition-colors"
          >
            Add Blanket
          </button>
          <button
            type="button"
            onClick={onCancel}
            className="px-6 py-3 bg-gray-200 text-gray-700 rounded-xl font-semibold hover:bg-gray-300 transition-colors"
          >
            Cancel
          </button>
        </div>
      </form>
    </div>
  );
}

// Liner Card Component
function LinerCard({ liner, blankets, onUpdate, onDelete, onPair }) {
  const [isEditing, setIsEditing] = useState(false);
  const [editName, setEditName] = useState(liner.name);
  const [editGrams, setEditGrams] = useState(liner.grams);
  const [editColor, setEditColor] = useState(liner.color);

  const pairedBlanket = blankets.find(b => b.id === liner.pairedWithBlanketId);
  const availableBlankets = blankets.filter(b =>
    !blankets.some(bl => bl.id === b.id && liner.pairedWithBlanketId !== b.id)
  );

  const handleSave = () => {
    onUpdate({
      name: editName,
      grams: parseInt(editGrams),
      color: editColor,
    });
    setIsEditing(false);
  };

  const handleCancel = () => {
    setEditName(liner.name);
    setEditGrams(liner.grams);
    setEditColor(liner.color);
    setIsEditing(false);
  };

  const colorOptions = [
    { value: '#E8D4C4', label: 'Cream' },
    { value: '#C9B8A8', label: 'Taupe' },
    { value: '#D4A84B', label: 'Gold' },
    { value: '#8B4513', label: 'Saddle Brown' },
    { value: '#2C3E50', label: 'Navy' },
    { value: '#27AE60', label: 'Green' },
  ];

  return (
    <div className={`bg-white rounded-2xl p-5 shadow-lg border-2 transition-all ${
      pairedBlanket ? 'border-[#9CAF88]' : 'border-[rgba(139,69,19,0.15)]'
    }`}>
      <div className="flex items-start justify-between mb-3">
        <div className="flex items-center gap-3">
          <div
            className="w-12 h-12 rounded-xl flex items-center justify-center shadow-md"
            style={{ backgroundColor: liner.color }}
          >
            <LinerIcon className="w-8 h-8 text-white/90" />
          </div>
          <div>
            {isEditing ? (
              <input
                type="text"
                value={editName}
                onChange={(e) => setEditName(e.target.value)}
                className="text-lg font-display font-bold text-[#5C4033] border-b-2 border-[#D4A84B] bg-transparent focus:outline-none"
              />
            ) : (
              <h3 className="font-display text-lg font-bold text-[#5C4033]">{liner.name}</h3>
            )}
            <div className="flex items-center gap-2 mt-1">
              <span className="text-sm font-medium text-[#6B5344]">{liner.grams}g</span>
              {pairedBlanket && (
                <span className="text-xs font-medium px-2 py-0.5 rounded-full bg-[#9CAF88]/20 text-[#9CAF88]">
                  Paired
                </span>
              )}
            </div>
          </div>
        </div>
        <div className="flex gap-2">
          {isEditing ? (
            <>
              <button onClick={handleSave} className="px-3 py-1.5 bg-[#9CAF88] text-white rounded-lg text-sm hover:bg-[#7d9470]">Save</button>
              <button onClick={handleCancel} className="px-3 py-1.5 bg-gray-200 text-gray-700 rounded-lg text-sm hover:bg-gray-300">Cancel</button>
            </>
          ) : (
            <>
              <button onClick={() => setIsEditing(true)} className="px-2 py-1.5 bg-[#FDF8F0] text-[#8B4513] rounded-lg text-sm hover:bg-[#D4A84B]/20">Edit</button>
              <button onClick={onDelete} className="px-2 py-1.5 bg-red-50 text-red-600 rounded-lg text-sm hover:bg-red-100">Delete</button>
            </>
          )}
        </div>
      </div>

      {isEditing ? (
        <div className="grid grid-cols-2 gap-3 mb-3">
          <div>
            <label className="block text-xs font-medium text-[#2C1810] mb-1">Weight (grams)</label>
            <select
              value={editGrams}
              onChange={(e) => setEditGrams(e.target.value)}
              className="w-full px-3 py-2 rounded-lg border border-[rgba(139,69,19,0.3)] focus:border-[#D4A84B] focus:outline-none text-sm"
            >
              <option value="100">100g (Light)</option>
              <option value="150">150g (Light)</option>
              <option value="200">200g (Medium)</option>
              <option value="250">250g (Medium)</option>
              <option value="300">300g (Heavy)</option>
            </select>
          </div>
          <div>
            <label className="block text-xs font-medium text-[#2C1810] mb-1">Color</label>
            <div className="flex flex-wrap gap-1">
              {colorOptions.map(option => (
                <button
                  key={option.value}
                  onClick={() => setEditColor(option.value)}
                  className={`w-6 h-6 rounded-full border-2 transition-all ${editColor === option.value ? 'border-[#5C4033] scale-110' : 'border-transparent'}`}
                  style={{ backgroundColor: option.value }}
                  title={option.label}
                />
              ))}
            </div>
          </div>
        </div>
      ) : (
        <div className="mb-3">
          {pairedBlanket ? (
            <div className="bg-[#9CAF88]/10 rounded-xl p-3">
              <div className="text-xs text-[#6B5344] mb-1">Paired with</div>
              <div className="flex items-center gap-2">
                <div className="w-6 h-6 rounded-md" style={{ backgroundColor: pairedBlanket.color }} />
                <span className="font-medium text-[#5C4033]">{pairedBlanket.name}</span>
                <span className="text-sm text-[#6B5344]">({pairedBlanket.grams}g + {liner.grams}g = {pairedBlanket.grams + liner.grams}g)</span>
              </div>
            </div>
          ) : (
            <div className="bg-[#FDF8F0] rounded-xl p-3 text-center text-[#6B5344] text-sm">
              Not paired with any blanket
            </div>
          )}
        </div>
      )}

      {!isEditing && (
        <div className="flex gap-2">
          <select
            value={liner.pairedWithBlanketId || ''}
            onChange={(e) => onPair(e.target.value ? parseInt(e.target.value) : null)}
            className="flex-1 px-3 py-2 rounded-lg border border-[rgba(139,69,19,0.3)] focus:border-[#D4A84B] focus:outline-none text-sm"
          >
            <option value="">No blanket (unpaired)</option>
            {blankets.map(b => (
              <option key={b.id} value={b.id}>{b.name} ({b.grams}g)</option>
            ))}
          </select>
        </div>
      )}
    </div>
  );
}

// Add Liner Form
function AddLinerForm({ onAdd, onCancel }) {
  const [name, setName] = useState('');
  const [grams, setGrams] = useState('100');
  const [color, setColor] = useState('#E8D4C4');

  const colorOptions = [
    { value: '#E8D4C4', label: 'Cream' },
    { value: '#C9B8A8', label: 'Taupe' },
    { value: '#D4A84B', label: 'Gold' },
    { value: '#8B4513', label: 'Saddle Brown' },
    { value: '#2C3E50', label: 'Navy' },
    { value: '#27AE60', label: 'Green' },
  ];

  const handleSubmit = (e) => {
    e.preventDefault();
    if (!name.trim()) return;
    onAdd({
      id: Date.now(),
      name: name.trim(),
      grams: parseInt(grams),
      color,
      pairedWithBlanketId: null,
    });
  };

  return (
    <div className="bg-white rounded-2xl p-5 shadow-lg border-2 border-dashed border-[#9CAF88]">
      <h3 className="font-display text-lg font-semibold text-[#5C4033] mb-3">Add New Liner</h3>
      <form onSubmit={handleSubmit} className="space-y-3">
        <div>
          <label className="block text-sm font-medium text-[#2C1810] mb-1">Liner Name *</label>
          <input
            type="text"
            value={name}
            onChange={(e) => setName(e.target.value)}
            className="w-full px-3 py-2 rounded-lg border border-[rgba(139,69,19,0.3)] focus:border-[#9CAF88] focus:outline-none"
            placeholder="e.g., Fleece Liner"
            required
          />
        </div>
        <div className="grid grid-cols-2 gap-3">
          <div>
            <label className="block text-sm font-medium text-[#2C1810] mb-1">Weight</label>
            <select
              value={grams}
              onChange={(e) => setGrams(e.target.value)}
              className="w-full px-3 py-2 rounded-lg border border-[rgba(139,69,19,0.3)] focus:border-[#9CAF88] focus:outline-none"
            >
              <option value="100">100g (Light)</option>
              <option value="150">150g (Light)</option>
              <option value="200">200g (Medium)</option>
              <option value="250">250g (Medium)</option>
              <option value="300">300g (Heavy)</option>
            </select>
          </div>
          <div>
            <label className="block text-sm font-medium text-[#2C1810] mb-1">Color</label>
            <div className="flex flex-wrap gap-2">
              {colorOptions.map(option => (
                <button
                  key={option.value}
                  type="button"
                  onClick={() => setColor(option.value)}
                  className={`w-8 h-8 rounded-full border-2 transition-all ${color === option.value ? 'border-[#5C4033] scale-110' : 'border-gray-200'}`}
                  style={{ backgroundColor: option.value }}
                  title={option.label}
                />
              ))}
            </div>
          </div>
        </div>
        <div className="flex gap-2 pt-1">
          <button type="submit" className="flex-1 py-2 bg-[#9CAF88] text-white rounded-xl font-semibold hover:bg-[#7d9470]">Add Liner</button>
          <button type="button" onClick={onCancel} className="px-4 py-2 bg-gray-200 text-gray-700 rounded-xl font-semibold hover:bg-gray-300">Cancel</button>
        </div>
      </form>
    </div>
  );
}

// Main Blanket Inventory Page
export default function BlanketInventory({
  blankets,
  liners,
  currentBlanketId,
  setCurrentBlanketId,
  onAddBlanket,
  onUpdateBlanket,
  onDeleteBlanket,
  onAddLiner,
  onUpdateLiner,
  onDeleteLiner
}) {
  const [showAddForm, setShowAddForm] = useState(false);
  const [showAddLinerForm, setShowAddLinerForm] = useState(false);
  const [filterCategory, setFilterCategory] = useState('all');
  const [deleteBlanketConfirm, setDeleteBlanketConfirm] = useState({ show: false, blanketId: null, blanketName: '' });
  const [deleteLinerConfirm, setDeleteLinerConfirm] = useState({ show: false, linerId: null, linerName: '' });
  const [isDeleting, setIsDeleting] = useState(false);

  const handleAddBlanket = async (newBlanket) => {
    try {
      await onAddBlanket(newBlanket);
      setShowAddForm(false);
    } catch (err) {
      console.error('Failed to add blanket:', err);
      alert('Failed to add blanket. Please try again.');
    }
  };

  const handleUpdateBlanket = async (blanketId, updates) => {
    try {
      await onUpdateBlanket(blanketId, updates);
    } catch (err) {
      console.error('Failed to update blanket:', err);
      alert('Failed to update blanket. Please try again.');
    }
  };

  const handleDeleteBlanket = (blanketId) => {
    if (blankets.length <= 1) {
      alert("You must have at least one blanket.");
      return;
    }
    const blanket = blankets.find(b => b.id === blanketId);
    setDeleteBlanketConfirm({ show: true, blanketId, blanketName: blanket?.name || 'this blanket' });
  };

  const confirmDeleteBlanket = async () => {
    const { blanketId } = deleteBlanketConfirm;
    setIsDeleting(true);
    try {
      await onDeleteBlanket(blanketId);
      // Unpair any liners that were paired with this blanket
      if (liners && onUpdateLiner) {
        for (const liner of liners) {
          if (liner.pairedWithBlanketId === blanketId) {
            await onUpdateLiner(liner.id, { pairedWithBlanketId: null });
          }
        }
      }
      if (currentBlanketId === blanketId) {
        setCurrentBlanketId(blankets.find(b => b.id !== blanketId)?.id);
      }
      setDeleteBlanketConfirm({ show: false, blanketId: null, blanketName: '' });
    } catch (err) {
      console.error('Failed to delete blanket:', err);
      alert('Failed to delete blanket. Please try again.');
    } finally {
      setIsDeleting(false);
    }
  };

  // Liner handlers
  const handleAddLiner = async (newLiner) => {
    try {
      await onAddLiner(newLiner);
      setShowAddLinerForm(false);
    } catch (err) {
      console.error('Failed to add liner:', err);
      alert('Failed to add liner. Please try again.');
    }
  };

  const handleUpdateLiner = async (linerId, updates) => {
    try {
      await onUpdateLiner(linerId, updates);
    } catch (err) {
      console.error('Failed to update liner:', err);
      alert('Failed to update liner. Please try again.');
    }
  };

  const handleDeleteLiner = (linerId) => {
    const liner = liners.find(l => l.id === linerId);
    setDeleteLinerConfirm({ show: true, linerId, linerName: liner?.name || 'this liner' });
  };

  const confirmDeleteLiner = async () => {
    const { linerId } = deleteLinerConfirm;
    setIsDeleting(true);
    try {
      await onDeleteLiner(linerId);
      setDeleteLinerConfirm({ show: false, linerId: null, linerName: '' });
    } catch (err) {
      console.error('Failed to delete liner:', err);
      alert('Failed to delete liner. Please try again.');
    } finally {
      setIsDeleting(false);
    }
  };

  const handlePairLiner = async (linerId, blanketId) => {
    try {
      // First, unpair any other liner that was paired with this blanket
      if (blanketId) {
        for (const liner of liners) {
          if (liner.pairedWithBlanketId === blanketId && liner.id !== linerId) {
            await onUpdateLiner(liner.id, { pairedWithBlanketId: null });
          }
        }
      }
      // Then pair the selected liner
      await onUpdateLiner(linerId, { pairedWithBlanketId: blanketId });
    } catch (err) {
      console.error('Failed to pair liner:', err);
      alert('Failed to pair liner. Please try again.');
    }
  };

  const filteredBlankets = filterCategory === 'all'
    ? blankets
    : blankets.filter(b => {
        const cat = getWeightCategory(b.grams);
        return cat.label.toLowerCase().includes(filterCategory.toLowerCase());
      });

  // Summary stats
  const totalBlankets = blankets.length;
  const waterproofCount = blankets.filter(b => b.waterproof).length;
  const neckRugCount = blankets.filter(b => b.hasNeckRug).length;
  const inUseCount = currentBlanketId ? 1 : 0;
  const totalLiners = liners?.length || 0;
  const pairedLiners = liners?.filter(l => l.pairedWithBlanketId !== null).length || 0;

  return (
    <div className="p-4 sm:p-6 max-w-5xl mx-auto">
      {/* Page Header */}
      <div className="flex flex-col sm:flex-row sm:items-center justify-between gap-4 mb-6">
        <div>
          <h1 className="font-display text-2xl sm:text-3xl font-bold text-[#5C4033]">Blanket Inventory</h1>
          <p className="text-[#6B5344] mt-1 text-sm sm:text-base">Manage your horse blankets and track their usage</p>
        </div>
        {!showAddForm && (
          <button
            onClick={() => setShowAddForm(true)}
            className="flex items-center justify-center gap-2 px-5 py-3 min-h-[44px] bg-[#9CAF88] text-white rounded-xl font-semibold hover:bg-[#7d9470] transition-colors w-full sm:w-auto"
          >
            <span className="text-xl">+</span> Add Blanket
          </button>
        )}
      </div>

      {/* Summary Cards */}
      <div className="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-5 gap-3 sm:gap-4 mb-6">
        <div className="bg-white rounded-xl p-3 sm:p-4 shadow border border-[rgba(139,69,19,0.15)] text-center">
          <div className="flex justify-center text-[#8B4513] mb-2">
            <Icon name="blanket" className="w-6 h-6 sm:w-8 sm:h-8" />
          </div>
          <div className="text-xl sm:text-2xl font-bold text-[#5C4033]">{totalBlankets}</div>
          <div className="text-xs sm:text-sm text-[#6B5344]">Total Blankets</div>
        </div>
        <div className="bg-white rounded-xl p-3 sm:p-4 shadow border border-[rgba(139,69,19,0.15)] text-center">
          <div className="flex justify-center text-[#8B4513] mb-2">
            <Icon name="droplet" className="w-6 h-6 sm:w-8 sm:h-8" />
          </div>
          <div className="text-xl sm:text-2xl font-bold text-[#5C4033]">{waterproofCount}</div>
          <div className="text-xs sm:text-sm text-[#6B5344]">Waterproof</div>
        </div>
        <div className="bg-white rounded-xl p-3 sm:p-4 shadow border border-[rgba(139,69,19,0.15)] text-center">
          <div className="flex justify-center text-[#8B4513] mb-2">
            <Icon name="check" className="w-6 h-6 sm:w-8 sm:h-8" />
          </div>
          <div className="text-xl sm:text-2xl font-bold text-[#5C4033]">{neckRugCount}</div>
          <div className="text-xs sm:text-sm text-[#6B5344]">With Neck Rug</div>
        </div>
        <div className="bg-white rounded-xl p-3 sm:p-4 shadow border border-[rgba(139,69,19,0.15)] text-center">
          <div className="flex justify-center text-[#9CAF88] mb-2">
            <Icon name="check" className="w-6 h-6 sm:w-8 sm:h-8" />
          </div>
          <div className="text-xl sm:text-2xl font-bold text-[#5C4033]">{inUseCount}</div>
          <div className="text-xs sm:text-sm text-[#6B5344]">In Use</div>
        </div>
        <div className="bg-white rounded-xl p-3 sm:p-4 shadow border border-[rgba(139,69,19,0.15)] text-center col-span-2 sm:col-span-1">
          <div className="flex justify-center text-[#8B4513] mb-2">
            <Icon name="box" className="w-6 h-6 sm:w-8 sm:h-8" />
          </div>
          <div className="text-xl sm:text-2xl font-bold text-[#5C4033]">{totalBlankets - inUseCount}</div>
          <div className="text-xs sm:text-sm text-[#6B5344]">Available</div>
        </div>
      </div>

      {/* Filter Tabs */}
      <div className="flex gap-2 mb-6 overflow-x-auto pb-2 -mx-4 px-4 sm:mx-0 sm:px-0">
        {['all', 'sheet', 'lightweight', 'medium', 'heavyweight'].map(category => (
          <button
            key={category}
            onClick={() => setFilterCategory(category)}
            className={`px-3 sm:px-4 py-2 min-h-[44px] rounded-lg font-medium transition-colors whitespace-nowrap text-sm sm:text-base ${
              filterCategory === category
                ? 'bg-[#8B4513] text-white'
                : 'bg-white text-[#6B5344] hover:bg-[#FDF8F0] border border-[rgba(139,69,19,0.15)]'
            }`}
          >
            {category.charAt(0).toUpperCase() + category.slice(1)}
          </button>
        ))}
      </div>

      {/* Add Blanket Form */}
      {showAddForm && (
        <div className="mb-6">
          <AddBlanketForm onAdd={handleAddBlanket} onCancel={() => setShowAddForm(false)} />
        </div>
      )}

      {/* Blanket Grid */}
      <div className="grid grid-cols-1 lg:grid-cols-2 gap-4 sm:gap-6">
        {filteredBlankets.map(blanket => (
          <BlanketCard
            key={blanket.id}
            blanket={blanket}
            pairedLiner={liners?.find(l => l.pairedWithBlanketId === blanket.id)}
            isInUse={blanket.id === currentBlanketId}
            onUpdate={(updates) => handleUpdateBlanket(blanket.id, updates)}
            onDelete={() => handleDeleteBlanket(blanket.id)}
            onSetInUse={() => setCurrentBlanketId(blanket.id)}
          />
        ))}
      </div>

      {/* Empty State */}
      {filteredBlankets.length === 0 && !showAddForm && (
        <div className="text-center py-16 bg-white rounded-2xl border border-[rgba(139,69,19,0.15)]">
          <div className="flex justify-center mb-4 text-[#8B4513]">
            <Icon name="blanket" className="w-16 h-16" />
          </div>
          <h2 className="font-display text-2xl font-semibold text-[#5C4033] mb-2">
            {filterCategory === 'all' ? 'No blankets yet' : `No ${filterCategory} blankets`}
          </h2>
          <p className="text-[#6B5344] mb-6">
            {filterCategory === 'all'
              ? 'Add your first blanket to start tracking your inventory'
              : 'Try a different filter or add a new blanket'}
          </p>
          {filterCategory === 'all' && (
            <button
              onClick={() => setShowAddForm(true)}
              className="px-6 py-3 bg-[#8B4513] text-white rounded-xl font-semibold hover:bg-[#5C4033] transition-colors"
            >
              Add Your First Blanket
            </button>
          )}
        </div>
      )}

      {/* Liners Section */}
      {liners && onAddLiner && (
        <div className="mt-8">
          <div className="flex items-center justify-between mb-4">
            <div>
              <h2 className="font-display text-2xl font-bold text-[#5C4033]">Blanket Liners</h2>
              <p className="text-[#6B5344] text-sm mt-1">
                {totalLiners} liner{totalLiners !== 1 ? 's' : ''}  {pairedLiners} paired
              </p>
            </div>
            {!showAddLinerForm && (
              <button
                onClick={() => setShowAddLinerForm(true)}
                className="flex items-center gap-2 px-4 py-2 bg-[#9CAF88] text-white rounded-xl font-semibold hover:bg-[#7d9470] transition-colors text-sm"
              >
                <span className="text-lg">+</span> Add Liner
              </button>
            )}
          </div>

          {/* Add Liner Form */}
          {showAddLinerForm && (
            <div className="mb-4">
              <AddLinerForm onAdd={handleAddLiner} onCancel={() => setShowAddLinerForm(false)} />
            </div>
          )}

          {/* Liner Grid */}
          {liners.length > 0 ? (
            <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
              {liners.map(liner => (
                <LinerCard
                  key={liner.id}
                  liner={liner}
                  blankets={blankets}
                  onUpdate={(updates) => handleUpdateLiner(liner.id, updates)}
                  onDelete={() => handleDeleteLiner(liner.id)}
                  onPair={(blanketId) => handlePairLiner(liner.id, blanketId)}
                />
              ))}
            </div>
          ) : !showAddLinerForm && (
            <div className="text-center py-8 bg-white rounded-2xl border border-[rgba(139,69,19,0.15)]">
              <div className="flex justify-center mb-3 text-[#9CAF88]">
                <LinerIcon className="w-12 h-12" />
              </div>
              <h3 className="font-display text-xl font-semibold text-[#5C4033] mb-2">No liners yet</h3>
              <p className="text-[#6B5344] mb-4 text-sm">Add liners to pair with your blanket shells for extra warmth</p>
              <button
                onClick={() => setShowAddLinerForm(true)}
                className="px-5 py-2 bg-[#9CAF88] text-white rounded-xl font-semibold hover:bg-[#7d9470] transition-colors"
              >
                Add Your First Liner
              </button>
            </div>
          )}
        </div>
      )}

      {/* Weight Guide */}
      <div className="mt-8 bg-white rounded-2xl p-4 sm:p-6 shadow border border-[rgba(139,69,19,0.15)]">
        <h2 className="font-display text-lg sm:text-xl font-semibold text-[#5C4033] mb-4">Blanket Weight Guide</h2>
        <div className="grid grid-cols-2 sm:grid-cols-4 gap-4">
          {weightCategories.map(cat => (
            <div key={cat.label} className="text-center">
              <div
                className="w-10 h-10 sm:w-12 sm:h-12 rounded-full mx-auto mb-2 flex items-center justify-center"
                style={{ backgroundColor: cat.color }}
              >
                <span className="text-white">
                  <Icon
                    name={cat.max === 0 ? 'rain' : cat.max <= 150 ? 'leaf' : 'snowflake'}
                    className="w-4 h-4 sm:w-5 sm:h-5"
                  />
                </span>
              </div>
              <div className="font-semibold text-[#5C4033] text-sm sm:text-base">{cat.label.split(' ')[0]}</div>
              <div className="text-xs text-[#6B5344]">
                {cat.max === 0 ? 'Above 40째F' : cat.max <= 150 ? '30-40째F' : cat.max <= 300 ? '15-30째F' : 'Below 15째F'}
              </div>
            </div>
          ))}
        </div>
      </div>

      {/* Delete Blanket Confirmation Modal */}
      <DeleteConfirmModal
        isOpen={deleteBlanketConfirm.show}
        onClose={() => setDeleteBlanketConfirm({ show: false, blanketId: null, blanketName: '' })}
        onConfirm={confirmDeleteBlanket}
        title="Delete Blanket"
        message="Are you sure you want to delete this blanket? Any paired liners will be unpaired."
        itemName={deleteBlanketConfirm.blanketName}
        loading={isDeleting}
      />

      {/* Delete Liner Confirmation Modal */}
      <DeleteConfirmModal
        isOpen={deleteLinerConfirm.show}
        onClose={() => setDeleteLinerConfirm({ show: false, linerId: null, linerName: '' })}
        onConfirm={confirmDeleteLiner}
        title="Delete Liner"
        message="Are you sure you want to delete this liner? This action cannot be undone."
        itemName={deleteLinerConfirm.linerName}
        loading={isDeleting}
      />
    </div>
  );
}
